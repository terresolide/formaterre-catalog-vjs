const E={parser:null,regex:null,proxy:null,init(e){this.parser=new DOMParser,e&&(this.regex=new RegExp(e.regex)),this.proxy=e.url},loadInfo(e,t,u,n){var r=e.url;console.log(r);var l=r;this.regex.test(r)&&this.proxy&&(l=this.proxy+"?url="+encodeURIComponent(r)),fetch(l).then(s=>s.text()).then(s=>{this.extract(s,e,t,u,n)})},extract(e,t,u,n,r){var l=this.parser.parseFromString(e,"text/xml"),s=l.children[0].getAttribute("xmlns"),h=l.children[0].getAttribute("xmlns:xlink"),a=function(P){switch(P){case"xlink":return h;default:return s}},g=this.getUrlGetMap(l,a);if(g==="")return null;u.url=g;var i=null;if(i=l.evaluate('//ns:Layer[ns:Name="'+t.name+'"]',l,a,XPathResult.ANY_TYPE,null),i.resultType!==XPathResult.UNORDERED_NODE_ITERATOR_TYPE&&i.resultType!==XPathResult.ORDERED_NODE_ITERATOR_TYPE)return null;var R=i.iterateNext();if(R===null)return null;t.url=g,t.title=this.getTitle(l,R,a),t.options={id:t.id,uuid:t.uuid,ESPG:this.getESPG(l,R,a),format:this.getFormat(l,a),opacity:u.opacity,layers:t.name,legend:this.getLegend(l,R,a)},typeof r<"u"&&r(t,n,u.zoom)},getUrlGetMap(e,t){var u=e.evaluate("//ns:Request/ns:GetMap/ns:DCPType/ns:HTTP/ns:Get/ns:OnlineResource/@xlink:href",e,t,XPathResult.STRING_TYPE,null);return u.stringValue},getESPG(e,t,u){var n=e.evaluate('count(./ns:CRS[text()="EPSG:3857"])',t,u,XPathResult.NUMBER_TYPE,null);if(n.numberValue>0)return"3857";var n=e.evaluate('count(./ns:CRS[text()="EPSG:4326"])',t,u,XPathResult.NUMBER_TYPE,null);if(n.numberValue>0)return"4326";var n=e.evaluate('count(./ns:CRS[text()="EPSG:3395"])',t,u,XPathResult.NUMBER_TYPE,null);return n.numberValue>0?"3395":null},getFormat(e,t){var u=e.evaluate('count(//ns:Request/ns:GetMap[ns:Format="image/png"])',e,t,XPathResult.NUMBER_TYPE,null);if(u.numberValue>0)return"image/png";var u=e.evaluate('count(//ns:Request/ns:GetMap[ns:Format="image/jpeg"])',e,t,XPathResult.NUMBER_TYPE,null);return u.numberValue>0?"image/jpeg":null},getTitle(e,t,u){var n=e.evaluate("./ns:Title/text()",t,u,XPathResult.STRING_TYPE,null);return n.stringValue},getAbstract(e,t,u){var n=e.evaluate("./ns:Abstract/text()",t,u,XPathResult.STRING_TYPE,null);return n.stringValue},getGeographicBoundingBox(e,t,u){},getLegend(e,t,u){var r=e.evaluate("./ns:Style/ns:LegendURL/ns:OnlineResource/@xlink:href",t,u,XPathResult.STRING_TYPE,null),n=r.stringValue,r=e.evaluate("./ns:Style/ns:Title",t,u,XPathResult.STRING_TYPE,null),l=r.stringValue;return n!==""?{src:n,title:l}:null}};export{E as default};
