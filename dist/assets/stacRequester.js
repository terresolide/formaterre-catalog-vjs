import{q as k}from"./index.js";function T(c,d={},g=24,y){k(),console.log(c);const l={};for(var m in d)l[m.replace(":","_")]=m;const p={page:1,limit:g,query:{},sortBy:[{direction:"desc",field:"start_datetime"}]},f=d,h=c;function q(t){}function v(t,i,e){u(i);var s={"Content-Type":"application/json"};return e&&(s.Authorization="Bearer "+e),new Promise((r,o)=>{fetch(h,{headers:s,method:"POST",body:JSON.stringify(p)}).then(a=>a.json()).then(a=>{var n=b(t,a);r&&r(n)}).catch(a=>{o&&o(a)})})}function u(t){if(t.query.from){var i=parseInt(t.query.to)-parseInt(t.query.from)+1;p.limit=i,p.page=Math.round((parseInt(t.query.from)-1)/i)+1}if(t.query.bbox){var e=t.query.bbox.split(",");p.bbox=e.map(o=>parseFloat(o))}t.query.start&&(p.query.end_datetime={gte:t.query.start+"T00:00:00.000Z"}),t.query.end&&(p.query.start_datetime={lte:t.query.end+"T23:59:59.000Z"});for(var s in f)p.query[s]={in:f[s]};for(var s in t.query)["from","to","bbox","start","end"].indexOf(s)<0&&(p.query[s]={in:t.query[s].split(",")});for(var r in l)t.query[r]&&(p.query[l[r]]={in:t.query[r].split(",")})}function b(t,i){console.log(t.keyword);var e=[];i.features.forEach(function(n){var _=x(t,n);e.push(_)});var s={count:e.length};i.context&&i.context.matched&&(s.total=parseInt(i.context.matched));var r={};for(var o in d)if(d[o].length>1){var a=d[o].map(n=>({key:n,label:n,count:null}));r[o]={category:a,meta:{label:o.replace(":","_"),type:"dimension"}}}return{list:e,pagination:s,aggregations:r}}function x(t,i){var e={};e.fromStac=!0,e.cds=y,e.hierachyLevel={icon:"file",name:"dataset"},e.geom=[i.geometry],e.uuid=i.id,e.id=i.id,e.links={},i.properties.identifier&&(e.identifier=i.properties.identifier,e.title=i.properties.identifier),i.properties.start_datetime&&(e.temporalExtents=[{start:{date:i.properties.start_datetime.substring(0,10)},end:{date:i.properties.end_datetime.substring(0,10)}}]),i.properties.datetime&&(e.dateStamp=i.properties.datetime),i.properties["processing:datetime"]&&(e.processingDate=i.properties["processing:datetime"]),i.properties["spaceborne:keywords"]&&(e.keyword=i.properties["spaceborne:keywords"]),i.properties["raster:spatial_resolution"]&&(e.resolution=[i.properties["raster:spatial_resolution"]+"m"]),e.links={download:[]};for(var s in i.assets)i.assets[s].roles.indexOf("thumbnail")>=0?e.quicklook={src:i.assets[s].href,title:""}:i.assets[s].roles.indexOf("overview")>=0?(e.images||(e.images=[]),e.images.push([i.assets[s].title,i.assets[s].href,""])):i.assets[s].roles.indexOf("data")>=0&&e.links.download.push({url:i.assets[s].href,name:s,type:"download",description:"",access:t.links.api.STAC.access});for(var s in i.properties)if(["identifier","instrument","subtitle","platform","product:type","grid:code"].indexOf(s)>=0)e[s]=i.properties[s];else if(s.indexOf("sar:")>=0||s.indexOf("sat:")>=0){var r=s.split(":"),o=r.pop();e[o]=i.properties[s]}e.exportLinks={};var a=i.links.find(n=>n.rel==="self");return a&&(e.exportLinks.json=a.href),e.crs=t.crs,e.contacts=t.contacts,e.legalConstraints=t.legalConstraints,e.lineage=t.lineage,e.representation=t.representation,e.status=t.status,e.dataCenter=t.dataCenter,e.keyword=[],t.keyword.forEach(function(n){n.key!=="th_regions"&&e.keyword.push(n)}),e}return{getRecords:v,setToken:q}}export{T as stacRequester};
