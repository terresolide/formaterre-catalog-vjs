import{q as _}from"./index.js";function T(c,d={},g=24,k){_(),console.log(c);const l={};for(var f in d)l[f.replace(":","_")]=f;const p={page:1,limit:g,query:{},sortBy:[{direction:"desc",field:"start_datetime"}]},m=d,y=c;function h(i){}function q(i,t,e){u(t);var r={"Content-Type":"application/json"};return e&&(r.Authorization="Bearer "+e),new Promise((s,o)=>{fetch(y,{headers:r,method:"POST",body:JSON.stringify(p)}).then(a=>a.json()).then(a=>{var n=v(i,a);s&&s(n)}).catch(a=>{o&&o(a)})})}function u(i){if(i.query.from){var t=parseInt(i.query.to)-parseInt(i.query.from)+1;p.limit=t,p.page=Math.round((parseInt(i.query.from)-1)/t)+1}if(i.query.bbox){var e=i.query.bbox.split(",");p.bbox=e.map(o=>parseFloat(o))}i.query.start&&(p.query.end_datetime={gte:i.query.start+"T00:00:00.000Z"}),i.query.end&&(p.query.start_datetime={lte:i.query.end+"T23:59:59.000Z"});for(var r in m)p.query[r]={in:m[r]};for(var r in i.query)["from","to","bbox","start","end"].indexOf(r)<0&&(p.query[r]={in:i.query[r].split(",")});for(var s in l)i.query[s]&&(p.query[l[s]]={in:i.query[s].split(",")})}function v(i,t){var e=[];t.features.forEach(function(n){var x=b(i,n);e.push(x)});var r={count:e.length};t.context&&t.context.matched&&(r.total=parseInt(t.context.matched));var s={};for(var o in d)if(d[o].length>1){var a=d[o].map(n=>({key:n,label:n,count:null}));s[o]={category:a,meta:{label:o.replace(":","_"),type:"dimension"}}}return{list:e,pagination:r,aggregations:s}}function b(i,t){var e={};e.fromStac=!0,e.group=i.group,e.hierachyLevel={icon:"file",name:"dataset"},e.geom=[t.geometry],e.uuid=t.id,e.id=t.id,e.links={},t.properties.identifier&&(e.identifier=t.properties.identifier,e.title=t.properties.identifier),t.properties.start_datetime&&(e.temporalExtents=[{start:{date:t.properties.start_datetime.substring(0,10)},end:{date:t.properties.end_datetime.substring(0,10)}}]),t.properties.datetime&&(e.dateStamp=t.properties.datetime),t.properties["processing:datetime"]&&(e.processingDate=t.properties["processing:datetime"]),t.properties["spaceborne:keywords"]&&(e.keyword=t.properties["spaceborne:keywords"]),t.properties["raster:spatial_resolution"]&&(e.resolution=[t.properties["raster:spatial_resolution"]+"m"]),e.links={download:[]};for(var r in t.assets)t.assets[r].roles.indexOf("thumbnail")>=0?e.quicklook={src:t.assets[r].href,title:""}:t.assets[r].roles.indexOf("overview")>=0?(e.images||(e.images=[]),e.images.push([t.assets[r].title,t.assets[r].href,""])):t.assets[r].roles.indexOf("data")>=0&&e.links.download.push({url:t.assets[r].href,name:r,type:"download",description:"",access:i.links.api.STAC.access});for(var r in t.properties)if(["identifier","instrument","subtitle","platform","product:type","grid:code"].indexOf(r)>=0)e[r]=t.properties[r];else if(r.indexOf("sar:")>=0||r.indexOf("sat:")>=0){var s=r.split(":"),o=s.pop();e[o]=t.properties[r]}e.exportLinks={};var a=t.links.find(n=>n.rel==="self");return a&&(e.exportLinks.json=a.href),e.keyword=[],e.parent={},e.crs||(e.parent.crs=i.crs),e.contacts||(e.parent.contacts=i.contacts),e.legalConstraints||(e.parent.legalConstraints=i.legalConstraints),e.lineage||(e.parent.lineage=i.lineage),e.representation||(e.parent.representation=i.representation),e.status||(e.parent.status=i.status),e.dataCenter||(e.parent.dataCenter=i.dataCenter),e.parent.keyword=[],i.keyword.forEach(function(n){n.key!=="th_regions"&&e.parent.keyword.push(n)}),e}return{getRecords:q,setToken:h}}export{T as stacRequester};
