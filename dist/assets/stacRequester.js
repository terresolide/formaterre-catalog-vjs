import{q as _}from"./index.js";function T(c,d={},g=24,y){_(),console.log(c);const l={};for(var m in d)l[m.replace(":","_")]=m;const p={page:1,limit:g,query:{},sortBy:[{direction:"desc",field:"start_datetime"}]},f=d,h=c;function q(i){}function v(i,t,e){u(t);var r={"Content-Type":"application/json"};return e&&(r.Authorization="Bearer "+e),new Promise((s,n)=>{fetch(h,{headers:r,method:"POST",body:JSON.stringify(p)}).then(a=>a.json()).then(a=>{var o=b(i,a);s&&s(o)}).catch(a=>{n&&n(a)})})}function u(i){if(i.query.from){var t=parseInt(i.query.to)-parseInt(i.query.from)+1;p.limit=t,p.page=Math.round((parseInt(i.query.from)-1)/t)+1}if(i.query.bbox){var e=i.query.bbox.split(",");p.bbox=e.map(n=>parseFloat(n))}i.query.start&&(p.query.end_datetime={gte:i.query.start+"T00:00:00.000Z"}),i.query.end&&(p.query.start_datetime={lte:i.query.end+"T23:59:59.000Z"});for(var r in f)p.query[r]={in:f[r]};for(var r in i.query)["from","to","bbox","start","end"].indexOf(r)<0&&(p.query[r]={in:i.query[r].split(",")});for(var s in l)i.query[s]&&(p.query[l[s]]={eq:i.query[s]})}function b(i,t){console.log(i.keyword);var e=[];t.features.forEach(function(o){var k=x(i,o);e.push(k)});var r={count:e.length};t.context&&t.context.matched&&(r.total=parseInt(t.context.matched));var s={};for(var n in d){var a=d[n].map(o=>({key:o,label:o,count:null}));s[n]={category:a,meta:{label:n.replace(":","_"),type:"dimension"}}}return{list:e,pagination:r,aggregations:s}}function x(i,t){var e={};e.fromStac=!0,e.cds=y,e.hierachyLevel={icon:"file",name:"dataset"},e.geom=[t.geometry],e.uuid=t.id,e.id=t.id,e.links={},t.properties.identifier&&(e.identifier=t.properties.identifier,e.title=t.properties.identifier),t.properties.start_datetime&&(e.temporalExtents=[{start:{date:t.properties.start_datetime.substring(0,10)},end:{date:t.properties.end_datetime.substring(0,10)}}]),t.properties.datetime&&(e.dateStamp=t.properties.datetime),t.properties["processing:datetime"]&&(e.processingDate=t.properties["processing:datetime"]),t.properties["spaceborne:keywords"]&&(e.keyword=t.properties["spaceborne:keywords"]),t.properties["raster:spatial_resolution"]&&(e.resolution=[t.properties["raster:spatial_resolution"]+"m"]),e.links={download:[]};for(var r in t.assets)t.assets[r].roles.indexOf("overview")>=0?(e.quicklook={src:t.assets[r].href,title:""},e.images=[[t.assets[r].title,t.assets[r].href,""]]):t.assets[r].roles.indexOf("data")>=0&&e.links.download.push({url:t.assets[r].href,name:r,type:"download",description:"",access:i.links.api.STAC.access});for(var r in t.properties)if(["identifier","instrument","subtitle","platform","product:type","grid:code"].indexOf(r)>=0)e[r]=t.properties[r];else if(r.indexOf("sar:")>=0||r.indexOf("sat:")>=0){var s=r.split(":"),n=s.pop();e[n]=t.properties[r]}e.exportLinks={};var a=t.links.find(o=>o.rel==="self");return a&&(e.exportLinks.json=a.href),e.crs=i.crs,e.contacts=i.contacts,e.legalConstraints=i.legalConstraints,e.lineage=i.lineage,e.representation=i.representation,e.status=i.status,e.dataCenter=i.dataCenter,e.keyword=[],i.keyword.forEach(function(o){o.key!=="th_regions"&&e.keyword.push(o)}),e}return{getRecords:v,setToken:q}}export{T as stacRequester};
